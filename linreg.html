<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Econometrics with R</title>
  <meta name="description" content="SciencesPo UG Econometrics online textbook. No Maths.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Econometrics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://scpoecon.github.io/ScPoEconometrics/" />
  
  <meta property="og:description" content="SciencesPo UG Econometrics online textbook. No Maths." />
  <meta name="github-repo" content="ScPoEcon/ScPoEconometrics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Econometrics with R" />
  
  <meta name="twitter:description" content="SciencesPo UG Econometrics online textbook. No Maths." />
  

<meta name="author" content="Florian Oswald, Jean-Marc Robin and Vincent Viers">


<meta name="date" content="2018-09-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.gif" type="image/x-icon">
<link rel="prev" href="sum.html">
<link rel="next" href="std-errors.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.8.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.39.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.39.2/plotly-latest.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41584331-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-41584331-4');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ScPo 2nd Year Econometrics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Syllabus</a></li>
<li class="chapter" data-level="1" data-path="R-intro.html"><a href="R-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to <code>R</code></a><ul>
<li class="chapter" data-level="1.1" data-path="R-intro.html"><a href="R-intro.html#getting-started"><i class="fa fa-check"></i><b>1.1</b> Getting Started</a></li>
<li class="chapter" data-level="1.2" data-path="R-intro.html"><a href="R-intro.html#starting-r-and-rstudio"><i class="fa fa-check"></i><b>1.2</b> Starting R and RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="R-intro.html"><a href="R-intro.html#basic-calculations"><i class="fa fa-check"></i><b>1.3</b> Basic Calculations</a></li>
<li class="chapter" data-level="1.4" data-path="R-intro.html"><a href="R-intro.html#getting-help"><i class="fa fa-check"></i><b>1.4</b> Getting Help</a></li>
<li class="chapter" data-level="1.5" data-path="R-intro.html"><a href="R-intro.html#installing-packages"><i class="fa fa-check"></i><b>1.5</b> Installing Packages</a></li>
<li class="chapter" data-level="1.6" data-path="R-intro.html"><a href="R-intro.html#code-output"><i class="fa fa-check"></i><b>1.6</b> <code>Code</code> vs Output in this Book</a></li>
<li class="chapter" data-level="1.7" data-path="R-intro.html"><a href="R-intro.html#install-package"><i class="fa fa-check"></i><b>1.7</b> <code>ScPoEconometrics</code> Package</a></li>
<li class="chapter" data-level="1.8" data-path="R-intro.html"><a href="R-intro.html#data-types"><i class="fa fa-check"></i><b>1.8</b> Data Types</a></li>
<li class="chapter" data-level="1.9" data-path="R-intro.html"><a href="R-intro.html#data-structures"><i class="fa fa-check"></i><b>1.9</b> Data Structures</a></li>
<li class="chapter" data-level="1.10" data-path="R-intro.html"><a href="R-intro.html#dataframes"><i class="fa fa-check"></i><b>1.10</b> Data Frames</a></li>
<li class="chapter" data-level="1.11" data-path="R-intro.html"><a href="R-intro.html#programming-basics"><i class="fa fa-check"></i><b>1.11</b> Programming Basics</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sum.html"><a href="sum.html"><i class="fa fa-check"></i><b>2</b> Working With Data</a><ul>
<li class="chapter" data-level="2.1" data-path="sum.html"><a href="sum.html#summary-statistics"><i class="fa fa-check"></i><b>2.1</b> Summary Statistics</a></li>
<li class="chapter" data-level="2.2" data-path="sum.html"><a href="sum.html#plotting"><i class="fa fa-check"></i><b>2.2</b> Plotting</a></li>
<li class="chapter" data-level="2.3" data-path="sum.html"><a href="sum.html#summarize-two"><i class="fa fa-check"></i><b>2.3</b> Summarizing Two Variables</a></li>
<li class="chapter" data-level="2.4" data-path="sum.html"><a href="sum.html#the-tidyverse"><i class="fa fa-check"></i><b>2.4</b> The <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="linreg.html"><a href="linreg.html"><i class="fa fa-check"></i><b>3</b> Linear Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="linreg.html"><a href="linreg.html#data-on-cars"><i class="fa fa-check"></i><b>3.1</b> Data on Cars</a></li>
<li class="chapter" data-level="3.2" data-path="linreg.html"><a href="linreg.html#dgp-and-models"><i class="fa fa-check"></i><b>3.2</b> DGP and Models</a></li>
<li class="chapter" data-level="3.3" data-path="linreg.html"><a href="linreg.html#lm-example1"><i class="fa fa-check"></i><b>3.3</b> An Example: California Student Test Scores</a></li>
<li class="chapter" data-level="3.4" data-path="linreg.html"><a href="linreg.html#the-lm-function"><i class="fa fa-check"></i><b>3.4</b> The <code>lm()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="std-errors.html"><a href="std-errors.html"><i class="fa fa-check"></i><b>4</b> Standard Errors</a><ul>
<li class="chapter" data-level="4.1" data-path="std-errors.html"><a href="std-errors.html#what-is-true"><i class="fa fa-check"></i><b>4.1</b> What is <em>true</em>?</a></li>
<li class="chapter" data-level="4.2" data-path="std-errors.html"><a href="std-errors.html#experiencing-standard-errors"><i class="fa fa-check"></i><b>4.2</b> Experiencing Standard Errors</a></li>
<li class="chapter" data-level="4.3" data-path="std-errors.html"><a href="std-errors.html#standard-errors-in-theory"><i class="fa fa-check"></i><b>4.3</b> Standard Errors in Theory</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-reg.html"><a href="multiple-reg.html"><i class="fa fa-check"></i><b>5</b> Multiple Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="multiple-reg.html"><a href="multiple-reg.html#california-test-scores-2"><i class="fa fa-check"></i><b>5.1</b> California Test Scores 2</a></li>
<li class="chapter" data-level="5.2" data-path="multiple-reg.html"><a href="multiple-reg.html#mreg-interactions"><i class="fa fa-check"></i><b>5.2</b> Interactions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="categorical-vars.html"><a href="categorical-vars.html"><i class="fa fa-check"></i><b>6</b> Categorial Variables</a><ul>
<li class="chapter" data-level="6.1" data-path="categorical-vars.html"><a href="categorical-vars.html#categorical-variables-in-r-factor"><i class="fa fa-check"></i><b>6.1</b> Categorical Variables in <code>R</code>: <code>factor</code></a></li>
<li class="chapter" data-level="6.2" data-path="categorical-vars.html"><a href="categorical-vars.html#saturated-models-main-effects-and-interactions"><i class="fa fa-check"></i><b>6.2</b> Saturated Models: Main Effects and Interactions</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="quantreg.html"><a href="quantreg.html"><i class="fa fa-check"></i><b>7</b> Quantile Regression</a></li>
<li class="chapter" data-level="8" data-path="panel-data.html"><a href="panel-data.html"><i class="fa fa-check"></i><b>8</b> Panel Data</a><ul>
<li class="chapter" data-level="8.1" data-path="panel-data.html"><a href="panel-data.html#fixed-effects"><i class="fa fa-check"></i><b>8.1</b> fixed effects</a></li>
<li class="chapter" data-level="8.2" data-path="panel-data.html"><a href="panel-data.html#did"><i class="fa fa-check"></i><b>8.2</b> DiD</a></li>
<li class="chapter" data-level="8.3" data-path="panel-data.html"><a href="panel-data.html#rdd"><i class="fa fa-check"></i><b>8.3</b> RDD</a></li>
<li class="chapter" data-level="8.4" data-path="panel-data.html"><a href="panel-data.html#example"><i class="fa fa-check"></i><b>8.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="IV.html"><a href="IV.html"><i class="fa fa-check"></i><b>9</b> Instrumental Variables</a><ul>
<li class="chapter" data-level="9.1" data-path="IV.html"><a href="IV.html#simultaneity-bias"><i class="fa fa-check"></i><b>9.1</b> Simultaneity Bias</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="logit-probit.html"><a href="logit-probit.html"><i class="fa fa-check"></i><b>10</b> Logit and Probit</a></li>
<li class="chapter" data-level="11" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>11</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="12" data-path="R-advanced.html"><a href="R-advanced.html"><i class="fa fa-check"></i><b>12</b> Advanced <code>R</code></a><ul>
<li class="chapter" data-level="12.1" data-path="R-advanced.html"><a href="R-advanced.html#more-vectorization"><i class="fa fa-check"></i><b>12.1</b> More Vectorization</a></li>
<li class="chapter" data-level="12.2" data-path="R-advanced.html"><a href="R-advanced.html#calculations-with-vectors-and-matrices"><i class="fa fa-check"></i><b>12.2</b> Calculations with Vectors and Matrices</a></li>
<li class="chapter" data-level="12.3" data-path="R-advanced.html"><a href="R-advanced.html#matrices-1"><i class="fa fa-check"></i><b>12.3</b> Matrices</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>13</b> Notes</a><ul>
<li class="chapter" data-level="13.1" data-path="notes.html"><a href="notes.html#book-usage"><i class="fa fa-check"></i><b>13.1</b> Book usage</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Econometrics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linreg" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Linear Regression</h1>
<div id="data-on-cars" class="section level2">
<h2><span class="header-section-number">3.1</span> Data on Cars</h2>
<p>We will look at the built-in <code>cars</code> dataset. Let’s get a view of this by just typing <code>View(cars)</code> in Rstudio. You can see something like this:</p>
<pre><code>#OUT&gt;   speed dist
#OUT&gt; 1     4    2
#OUT&gt; 2     4   10
#OUT&gt; 3     7    4
#OUT&gt; 4     7   22
#OUT&gt; 5     8   16
#OUT&gt; 6     9   10</code></pre>
<p>We have a <code>data.frame</code> with two columns: <code>speed</code> and <code>dist</code>. Type <code>help(cars)</code> to find out more about the dataset. There you could read that</p>
<blockquote>
<p>The data give the speed of cars (mph) and the distances taken to stop (ft).</p>
</blockquote>
<p>It’s good practice to know the extent of a dataset. You could just type</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(cars)</code></pre></div>
<pre><code>#OUT&gt; [1] 50  2</code></pre>
<p>to find out that we have 50 rows and 2 columns. A central question that we want to ask now is the following:</p>
<div id="how-are-speed-and-dist-related" class="section level3">
<h3><span class="header-section-number">3.1.1</span> How are <code>speed</code> and <code>dist</code> related?</h3>
<p>The simplest way to start is to plot the data. Remembering that we view each row of a data.frame as an observation, we could just label one axis of a graph <code>speed</code>, and the other one <code>dist</code>, and go through our table above row by row. We just have to read off the x/y coordinates and mark them in the graph. In <code>R</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(dist <span class="op">~</span><span class="st"> </span>speed, <span class="dt">data =</span> cars,
     <span class="dt">xlab =</span> <span class="st">&quot;Speed (in Miles Per Hour)&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Stopping Distance (in Feet)&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Stopping Distance vs Speed&quot;</span>,
     <span class="dt">pch  =</span> <span class="dv">20</span>,
     <span class="dt">cex  =</span> <span class="dv">2</span>,
     <span class="dt">col  =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>Here, each dot represents one observation. In this case, one particular measurement <code>speed</code> and <code>dist</code> for a car. Now, again:</p>
<div class="note">
<p>
How are <code>speed</code> and <code>dist</code> related? How could one best <em>summarize</em> this relationship?
</p>
</div>
<p><br> One thing we could do, is draw a straight line through this scatterplot, like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(dist <span class="op">~</span><span class="st"> </span>speed, <span class="dt">data =</span> cars,
     <span class="dt">xlab =</span> <span class="st">&quot;Speed (in Miles Per Hour)&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Stopping Distance (in Feet)&quot;</span>,
     <span class="dt">main =</span> <span class="st">&quot;Stopping Distance vs Speed&quot;</span>,
     <span class="dt">pch  =</span> <span class="dv">20</span>,
     <span class="dt">cex  =</span> <span class="dv">2</span>,
     <span class="dt">col  =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">abline</span>(<span class="dt">a =</span> <span class="dv">60</span>,<span class="dt">b =</span> <span class="dv">0</span>,<span class="dt">lw=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>Now that doesn’t seem a particularly <em>good</em> way to summarize the relationship. Clearly, a <em>better</em> line would be not be flat, but have a <em>slope</em>, i.e. go upwards:</p>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>That is slightly better. However, the line seems at too high a level - the point at which it crosses the y-axis is called the <em>intercept</em>; and it’s too high. We just learned how to represent a <em>line</em>, i.e. with two numbers called <em>intercept</em> and <em>slope</em>. So how to choose the <strong>best</strong> line?</p>
</div>
<div id="choosing-the-best-line" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Choosing the Best Line</h3>
<p>Suppose we have the following set of 9 observations on <code>x</code> and <code>y</code>, and we put the <em>best</em> straight line into it, that we can think of. It looks like this:</p>
<div class="figure" style="text-align: center"><span id="fig:line-arrows"></span>
<img src="ScPoEconometrics_files/figure-html/line-arrows-1.png" alt="The best line and its errors" width="672" />
<p class="caption">
Figure 3.1: The best line and its errors
</p>
</div>
<p>The red arrows indicate the <strong>distance</strong> of the line to each point and we call them <em>errors</em> or <em>residuals</em>, often written with the symbol <span class="math inline">\(\varepsilon\)</span>. An upward pointing arrow indicates a positive value of a particular <span class="math inline">\(\varepsilon_i\)</span>, and vice versa for downward pointing arrows. The name <em>residual</em> comes from the way we write an equation for this relationship between two particular values <span class="math inline">\((y_i,x_i)\)</span> belonging to observation <span class="math inline">\(i\)</span>:</p>
<p><span class="math display" id="eq:abline">\[
y_i = \beta_0 + \beta_1 x_i + \varepsilon_i \tag{3.1}
\]</span></p>
<p>Here <span class="math inline">\(\beta_0\)</span> is the intercept, and <span class="math inline">\(\beta_1\)</span> is the slope of our line, and <span class="math inline">\(\varepsilon_i\)</span> is the value of the arrow (i.e. a positive or negative number) indicating the distance between the actual <span class="math inline">\(y_i\)</span> and what is predicted by our line. In other words, <span class="math inline">\(\varepsilon_i\)</span> is what is left to be explained on top of the line <span class="math inline">\(\beta_0 + \beta_1 x_i\)</span>, hence, it’s a residual to explain <span class="math inline">\(y_i\)</span>. Now, back to our claim that this is the <em>best</em> line. What exactly characterizes the best line?</p>
<div class="warning">
<center>
The best line minimizes the sum of <strong>squared residuals</strong>, i.e. it minimizes the SSR: <span class="math display"><span class="math display">\[ \varepsilon_1^2 + \dots + \varepsilon_N^2 = \sum_{i=1}^N \varepsilon_i^2 \equiv \text{SSR}\]</span></span>
</center>
</div>
<p><br> Wait a moment, why <em>squared</em> residuals? This is easy to understand: suppose that instead, we wanted to just make the <em>sum</em> of the arrows in figure <a href="linreg.html#fig:line-arrows">3.1</a> as small as possible (that is, no squares). Choosing our line to make this number small would not give a particularly good representation of the data – given that errors of opposite sign and equal magnitude offset, we could have very long arrows (but of opposite signs), and a poor resulting line. Squaring each error avoids this (because now negative errors get positive values!) We illustrate this in figure <a href="linreg.html#fig:line-squares">3.2</a>. This is the same data as in figure <a href="linreg.html#fig:line-arrows">3.1</a>, but instead of arrows of length <span class="math inline">\(\varepsilon_i\)</span> for each observation <span class="math inline">\(i\)</span>, now we draw a square with side <span class="math inline">\(\varepsilon_i\)</span>, i.e. an area of <span class="math inline">\(\varepsilon_i^2\)</span>. You will see in the practical sessions that choosing a different line to this one will increase the sum of squares.</p>
<div class="figure" style="text-align: center"><span id="fig:line-squares"></span>
<img src="ScPoEconometrics_files/figure-html/line-squares-1.png" alt="The best line and its SQUARED errors" width="672" />
<p class="caption">
Figure 3.2: The best line and its SQUARED errors
</p>
</div>
</div>
<div id="ordinary-least-squares-ols-coefficients" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Ordinary Least Squares (OLS) Coefficients</h3>
<p>The method to estimate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> we illustrated above is called <em>Ordinary Least Squares</em>, or OLS. There is a connection between the estimate for <span class="math inline">\(\beta_1\)</span> - denoted <span class="math inline">\(\hat{\beta}_1\)</span> - in equation <a href="linreg.html#eq:abline">(3.1)</a> and the <em>covariance</em> of <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> - remember how we defined this in section <a href="sum.html#summarize-two">2.3</a>. In the simple case shown in equation <a href="linreg.html#eq:abline">(3.1)</a>, the relationship is</p>
<p><span class="math display" id="eq:beta1hat">\[
\hat{\beta}_1 = \frac{cov(x,y)}{var(x)}.  \tag{3.2}
\]</span> i.e. the estimate of the slope coefficient is the covariance between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> divided by the variance of <span class="math inline">\(x\)</span>. Similarly, the estimate for the intercept is given by</p>
<p><span class="math display" id="eq:beta0hat">\[
\hat{\beta}_0 = \bar{y} - \hat{\beta}_1 \bar{x}.  \tag{3.3}
\]</span></p>
<p>where <span class="math inline">\(\bar{z}\)</span> denotes the sample mean of variable <span class="math inline">\(z\)</span>.</p>
</div>
<div id="correlation-covariance-and-linearity" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Correlation, Covariance and Linearity</h3>
<p>It is important to keep in mind that Correlation and Covariance relate to a <em>linear</em> relationship between <code>x</code> and <code>y</code>. Given how the regression line is estimated by OLS (see just above), you can see that the regression line inherits this property from the Covariance. A famous exercise by Francis Anscombe (1973) illustrates this by constructing 4 different datasets which all have identical <strong>linear</strong> statistics: mean, variance, correlation and regression line <em>are identical</em>. However, the usefulness of the statistics to describe the relationship in the data is not clear.</p>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<p>The important lesson from this example is the following:</p>
<div class="warning">
<center>
Always <strong>visually inspect</strong> your data, and don’t rely exclusively on summary statistics like <em>mean, variance, correlation and regression line</em>. All of those assume a <strong>linear</strong> relationship between the variables in your data.
</center>
</div>
</div>
<div id="non-linear-relationships-in-data" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Non-Linear Relationships in Data</h3>
<p>Suppose our data now looks like this:</p>
<p><img src="ScPoEconometrics_files/figure-html/non-line-cars-1.png" width="672" /></p>
<p>Putting our previous <em>best line</em> defined in equation <a href="linreg.html#eq:abline">(3.1)</a> as <span class="math inline">\(y = \beta_0 + \beta_1 x + u\)</span>, we get something like this:</p>
<div class="figure" style="text-align: center"><span id="fig:non-line-cars-ols"></span>
<img src="ScPoEconometrics_files/figure-html/non-line-cars-ols-1.png" alt="Best line with non-linear data?" width="672" />
<p class="caption">
Figure 3.3: Best line with non-linear data?
</p>
</div>
<p>Somehow when looking at <a href="linreg.html#fig:non-line-cars-ols">3.3</a> one is not totally convinced that the straight line is a good summary of this relationship. For values <span class="math inline">\(x\in[50,120]\)</span> the line seems to low, then again too high, and it completely misses the right boundary. It’s easy to address this shortcoming by including <em>higher order terms</em> of an explanatory variable. We would modify <a href="linreg.html#eq:abline">(3.1)</a> to read now</p>
<p><span class="math display" id="eq:abline2">\[
y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \varepsilon_i \tag{3.4}
\]</span></p>
<p>This is a special case of <em>multiple regression</em>, which we will talk about in chapter <a href="multiple-reg.html#multiple-reg">5</a>. You can see that there are <em>multiple</em> slope coefficients. For now, let’s just see how this performs:</p>
<div class="figure" style="text-align: center"><span id="fig:non-line-cars-ols2"></span>
<img src="ScPoEconometrics_files/figure-html/non-line-cars-ols2-1.png" alt="Better line with non-linear data!" width="672" />
<p class="caption">
Figure 3.4: Better line with non-linear data!
</p>
</div>
</div>
</div>
<div id="dgp-and-models" class="section level2">
<h2><span class="header-section-number">3.2</span> DGP and Models</h2>
<p>When we talk about a <strong>model</strong> in econometrics, we are making assumptions about how <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> are related in the data. For example, we have repeatedly seen the following equation,</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \varepsilon_i 
\]</span></p>
<p>which is a particular kind of model. What <em>generated</em> our data, on the other hand, is an unknown mechanism that we want to investigate: it’s the <strong>data generating process</strong> (GDP), and our model is our assumption about how we think the GDP could look like. A natural question that comes to mind here, is <em>how to discriminate between models</em>, or in other words: which model to choose?</p>
<div id="assessing-the-goodness-of-fit" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Assessing the <em>Goodness of Fit</em></h3>
<p>In our simple setup, there exists a convenient measure for how good a particular statistical model fits the data. It is called <span class="math inline">\(R^2\)</span> (<em>R squared</em>), also called the <em>coefficient of determination</em>. It is a statistic that makes use of a <em>benchmark</em> model, against which to compare any given model we may have in mind. Suppose we posit our standard representation of the best line:</p>
<p><span class="math display" id="eq:ssr-mod">\[
y_i = \beta_0 + \beta_1 x_i + \varepsilon_i \tag{3.5} 
\]</span></p>
<p>and let us write down the benchmark model as follows:</p>
<p><span class="math display" id="eq:ssr-bench">\[
y_i = \beta_0 + \varepsilon_i \tag{3.6}
\]</span></p>
<p>As you can see, the benchmark model in <a href="linreg.html#eq:ssr-bench">(3.6)</a> is a model with an intercept only. You will see in one of our <code>apps</code> that this delivers an estimate of the mean of <span class="math inline">\(y\)</span>. It is a benchmark because it does not include <em>any</em> explanatory variables, so we can compare against this other models which do in fact contain some <span class="math inline">\(x\)</span>’s. Back to our <span class="math inline">\(R^2\)</span> statistic: there are several equivalent definitions, and for our present case we will use the following.</p>
<div class="tip">
<p>
The <strong>coefficient of determination</strong> (<em>R squared</em>) is defined by <span class="math display"><span class="math display">\[R^2 = 1 - \frac{\text{SSR our model}}{\text{SSR benchmark}}.\]</span></span> In the simple linear model, we have that <span class="math inline"><span class="math inline">\(R^2 \in [0,1]\)</span></span>, where <span class="math inline"><span class="math inline">\(R^2 = 1\)</span></span> would indicate that our model is a <strong>very good</strong> fit to the data, and vice versa for <span class="math inline"><span class="math inline">\(R^2 = 0\)</span></span>. You can interpret the value of <span class="math inline"><span class="math inline">\(R^2\)</span></span> as the fraction of variation in outcome <span class="math inline"><span class="math inline">\(y\)</span></span> that is accounted for by explanatory variable <span class="math inline"><span class="math inline">\(x\)</span></span>.
</p>
</div>
<p><br> The workings of this statistic are illustrated in the following figure <a href="linreg.html#fig:r-squared">3.5</a>. There, the left panel is our well-known depiction of the sum of squared residuals (SSR) of our model <span class="math inline">\(y_i = \beta_0 + \beta_1 x_i + \varepsilon_i\)</span>. The right panel shows the SSR of <span class="math inline">\(y_i = \beta_0 + \varepsilon_i\)</span>. Ideally, each red square would be small relative to its blue counterpart, indicating that our model has a small residual at a given observation.</p>
<div class="figure" style="text-align: center"><span id="fig:r-squared"></span>
<img src="ScPoEconometrics_files/figure-html/r-squared-1.png" alt="Left panel: SSR from our model. Right panel: SSR from benchmark (mean only) model. $R^2$ compares the size of each red square to each blue square." width="672" />
<p class="caption">
Figure 3.5: Left panel: SSR from our model. Right panel: SSR from benchmark (mean only) model. <span class="math inline">\(R^2\)</span> compares the size of each red square to each blue square.
</p>
</div>
</div>
</div>
<div id="lm-example1" class="section level2">
<h2><span class="header-section-number">3.3</span> An Example: California Student Test Scores</h2>
<p>Luckily for us, fitting a linear model to some data does not require us to iteratively find the best intercept and slope manually, as you have experienced in our <code>apps</code>. As it turns out, <code>R</code> can do this much more precisely, and very fast!</p>
<p>Let’s explore how to do this, using a real life dataset taken from the <code>Ecdat</code> package which includes many economics-related dataset. In this example, we will use the <code>Caschool</code>dataset which contains the average test scores of 420 elementary schools in California along with some additional information.</p>
<div id="loading-and-exploring-data" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Loading and exploring Data</h3>
<p>We can explore which variables are included in the dataset using the <code>names()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;Ecdat&quot;</span>) <span class="co"># Attach the Ecdat library</span>
<span class="kw">names</span>(Caschool) <span class="co"># Display the variables of the Caschool dataset</span></code></pre></div>
<pre><code>#OUT&gt;  [1] &quot;distcod&quot;  &quot;county&quot;   &quot;district&quot; &quot;grspan&quot;   &quot;enrltot&quot;  &quot;teachers&quot;
#OUT&gt;  [7] &quot;calwpct&quot;  &quot;mealpct&quot;  &quot;computer&quot; &quot;testscr&quot;  &quot;compstu&quot;  &quot;expnstu&quot; 
#OUT&gt; [13] &quot;str&quot;      &quot;avginc&quot;   &quot;elpct&quot;    &quot;readscr&quot;  &quot;mathscr&quot;</code></pre>
<p>For each variable in the dataset, basic summary statistics can be obtained by calling <code>summary()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(Caschool[, <span class="kw">c</span>(<span class="st">&quot;testscr&quot;</span>, <span class="st">&quot;str&quot;</span>, <span class="st">&quot;avginc&quot;</span>)])</code></pre></div>
<pre><code>#OUT&gt;     testscr           str            avginc      
#OUT&gt;  Min.   :605.5   Min.   :14.00   Min.   : 5.335  
#OUT&gt;  1st Qu.:640.0   1st Qu.:18.58   1st Qu.:10.639  
#OUT&gt;  Median :654.5   Median :19.72   Median :13.728  
#OUT&gt;  Mean   :654.2   Mean   :19.64   Mean   :15.317  
#OUT&gt;  3rd Qu.:666.7   3rd Qu.:20.87   3rd Qu.:17.629  
#OUT&gt;  Max.   :706.8   Max.   :25.80   Max.   :55.328</code></pre>
</div>
<div id="fitting-a-linear-model" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Fitting a linear model</h3>
<p>Suppose a policymaker is interested in the following linear model:</p>
<p><span class="math display">\[testscr_i = \beta_0 + \beta_1 \times str_i + \epsilon_i\]</span> Where <span class="math inline">\((testscr)_i\)</span> is the <em>average test score</em> for a given school <span class="math inline">\(i\)</span> and <span class="math inline">\((str)_i\)</span> is the <em>Student/Teacher Ratio</em> (i.e. the average number of students per teacher) in the same school <span class="math inline">\(i\)</span>. We can think of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> as the intercept and the slope of the regression line.</p>
<p>The subscript <span class="math inline">\(i\)</span> indexes all unique elementary schools (<span class="math inline">\(i \in \{1, 2, 3, \dots 420\}\)</span>) and <span class="math inline">\(\epsilon_i\)</span> is the error, or <em>residual</em>, of the regression. (Remember that our procedure for finding the line of best fit is to minimize the <em>sum of squared residuals</em> (SSR)).</p>
<hr />
<p>At this point you should step back and take a second to think about what you believe the relation between a school’s test scores and student/teacher ratio will be. Do you believe that, in general, a high student/teacher ratio will be associated with higher-than-average test scores for the school? Do you think that the number of students per teacher will impact results in any way?</p>
<p>Let’s find out! As always, we will start by plotting the data to inspect it visually (don’t worry if the syntax doesn’t make much sense right now, we will come back to it very soon):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str,
     <span class="dt">data =</span> Caschool,
     <span class="dt">xlab =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Average Test Score&quot;</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:first-reg0"></span>
<img src="ScPoEconometrics_files/figure-html/first-reg0-1.png" alt="Student Teacher Ratio vs Test Scores" width="672" />
<p class="caption">
Figure 3.6: Student Teacher Ratio vs Test Scores
</p>
</div>
<p>Can you spot a trend in the data? According to you, what would the line of best fit look like? Would it be upward or downward slopping? Let’s ask <code>R</code>!</p>
</div>
</div>
<div id="the-lm-function" class="section level2">
<h2><span class="header-section-number">3.4</span> The <code>lm()</code> function</h2>
<p>We will use the built-in <code>lm()</code> function to estimate the coefficients <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> using the data at hand. <code>lm</code> stands for <em>linear model</em>, which is what our representation in <a href="linreg.html#eq:abline">(3.1)</a> amounts to. This function typically only takes 2 arguments, <code>formula</code> and <code>data</code>:</p>
<p><code>lm(formula, data)</code></p>
<ul>
<li><p><code>formula</code> is the description of our model which we want <code>R</code> to estimate for us. Its syntax is very simple: <code>Y ~ X</code> (more generally, <code>DependentVariable ~ Independent Variables</code>). You can think of the tilda operator <code>~</code> as the equal sign in your model equation. An intercept is included by default and so you do not have to ask for it in <code>formula</code>. For example, the simple model <span class="math inline">\(income = \beta_0 + \beta_1 \cdot age\)</span> can be written as <code>income ~ age</code>. You can also ask <code>R</code> to estimate a multivariate regression such as <span class="math inline">\(income = \beta_0 + \beta_1 \cdot age + \beta_2 \cdot isWoman\)</span> by simply separating all variables on the right-hand side of the equation with the <code>+</code> operator, like this : <code>income ~ age + isWoman</code>. A <code>formula</code> can sometimes be written between quotation marks: <code>&quot;X ~ Y&quot;</code>.</p></li>
<li><p><code>data</code> is simply the <code>data.frame</code> containing the variables in the model.</p></li>
</ul>
<p>In the context of our example, the function call is therefore:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str, <span class="dt">data =</span> Caschool)</code></pre></div>
<pre><code>#OUT&gt; 
#OUT&gt; Call:
#OUT&gt; lm(formula = testscr ~ str, data = Caschool)
#OUT&gt; 
#OUT&gt; Coefficients:
#OUT&gt; (Intercept)          str  
#OUT&gt;      698.93        -2.28</code></pre>
<p>As we can see, <code>R</code> returns its estimates for the Intercept and Slope coefficients, <span class="math inline">\(\hat{\beta_0} =\)</span> 698.93 and <span class="math inline">\(\hat{\beta_1} =\)</span> -2.28. The estimated relationship between a school’s Student/Teacher Ratio and its average test results is <strong>negative</strong>.</p>
<p>Running a linear regression in <code>R</code> is typically a two-steps process. You first assign the output of the <code>lm()</code> call to an object and <strong>then</strong> call a second function (for our purpose, mainly <code>summary()</code>) on the resulting object. In practice, this looks like this :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assign lm() output to some object `fit_california`</span>
fit_california &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str, <span class="dt">data =</span> Caschool)

<span class="co"># ask R for the regression summary</span>
<span class="kw">summary</span>(fit_california) </code></pre></div>
<pre><code>#OUT&gt; 
#OUT&gt; Call:
#OUT&gt; lm(formula = testscr ~ str, data = Caschool)
#OUT&gt; 
#OUT&gt; Residuals:
#OUT&gt;     Min      1Q  Median      3Q     Max 
#OUT&gt; -47.727 -14.251   0.483  12.822  48.540 
#OUT&gt; 
#OUT&gt; Coefficients:
#OUT&gt;             Estimate Std. Error t value Pr(&gt;|t|)    
#OUT&gt; (Intercept) 698.9330     9.4675  73.825  &lt; 2e-16 ***
#OUT&gt; str          -2.2798     0.4798  -4.751 2.78e-06 ***
#OUT&gt; ---
#OUT&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
#OUT&gt; 
#OUT&gt; Residual standard error: 18.58 on 418 degrees of freedom
#OUT&gt; Multiple R-squared:  0.05124, Adjusted R-squared:  0.04897 
#OUT&gt; F-statistic: 22.58 on 1 and 418 DF,  p-value: 2.783e-06</code></pre>
<p>Again, we recognize our intercept and slope estimates from before, alongside some other numbers and indications. This output is called a <em>regression table</em>, and you will be able to decypher it by the end of this course. You should be able to find an interpret the <span class="math inline">\(R^2\)</span> though: Are we explaining a lot of the variance in <code>testscr</code> with this simple model, or not?</p>
<div id="plotting-the-regression-line" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Plotting the regression line</h3>
<p>We can also use our <code>lm</code> fit to draw the regression line on top of our initial scatterplot, using the following syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="dt">formula =</span> testscr <span class="op">~</span><span class="st"> </span>str,
     <span class="dt">data =</span> Caschool,
     <span class="dt">xlab =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>,
     <span class="dt">ylab =</span> <span class="st">&quot;Average Test Score&quot;</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)<span class="co"># same plot as before</span>
<span class="kw">abline</span>(fit_california, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co"># add regression line</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:plot-reg1"></span>
<img src="ScPoEconometrics_files/figure-html/plot-reg1-1.png" alt="Test Scores with Regression Line" width="672" />
<p class="caption">
Figure 3.7: Test Scores with Regression Line
</p>
</div>
<p>As you probably expected, the best line for schools’ Student/Teacher Ratio and its average test results is downward sloping.</p>
<p>Just as a way of showcasing another way to make the above plot, here is how you could use <code>ggplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> str, <span class="dt">y =</span> testscr), <span class="dt">data =</span> Caschool) <span class="co"># base plot</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="co"># add points</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="co"># add regression line</span>
p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Average Test Score&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">         </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Student/Teacher Ratio&quot;</span>)
p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Testscores vs Student/Teacher Ratio&quot;</span>)</code></pre></div>
<p><img src="ScPoEconometrics_files/figure-html/unnamed-chunk-120-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The shaded area around the red line shows the width of the 95% confidence interval around our estimate of the slope coefficient <span class="math inline">\(\beta_1\)</span>. We will learn more about it in the next chapter.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sum.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="std-errors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ScPoEcon/ScPoEconometrics/edit/master/04-linear-reg.Rmd",
"text": "Edit"
},
"download": ["ScPoEconometrics.pdf", "ScPoEconometrics.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
